(function($){var _default={opacity:0.5,color:'#222',zindex:1,styleClass:''};var _elements=[];var _targets=[];var _lastset;var actions={destroy:function(){this.each(function(i,e){destroyOne(e)})},setdefault:function(){$.each(arguments,function(i,e){$.extend(_default,e)})},destroyall:function(){while(_elements.length){_elements.pop()}while(_targets.length){var ele=_targets.pop();if(ele){ele.overlay.remove()}}_lastset=$("")},get:function(){if(!arguments.length){return _lastset}var rtn=$("");$.each(arguments,function(i,e){if(typeof e==='string'){var elems=$(e);elems.each(function(i,e){var ov=findOverlayForDOMElem(e);if(ov){rtn=rtn.add(ov)}})}else{var ov=findOverlayForDOMElem(e);if(ov){rtn=rtn.add(ov)}}});return rtn}};function findOverlayForDOMElem(e){var idx=$.inArray(e,_elements);if(idx===-1){return}return _targets[idx]?_targets[idx].overlay:undefined}function destroyOne(elem){var idx;if((idx=$.inArray(elem,_elements))===-1){return}_elements[idx]=undefined;_targets[idx].overlay.remove();_targets[idx]=undefined}$.fn.overlay=function(option){if('string'===typeof option){return actions[option].apply(this,[].slice.call(arguments,1))||this}if(!this.length){return this}option=$.extend({},_default,option);_lastset=new jQuery();this.each(function(i,e){if($.inArray(this,_elements)!==-1){return}var self=$(this);var overlay=$("<div>");if(!option['styleClass']){overlay.css("background-color",option['color']).css("z-index",option['zindex']).css("opacity",+option['opacity']).css("-ms-filter","progid:DXImageTransform.Microsoft.Alpha(Opacity="+(+option['opacity'])*100+")").css("filter","alpha(opacity="+(+option['opacity'])*100+")").css("margin","0").css("padding","0").css("border","none")}else{overlay.toggleClass(option['styleClass'])}if(self.css("position")==='fixed'){overlay.css("position","fixed")}else{overlay.css("position","absolute")}overlay.appendTo("body");_elements.push(this);_targets.push({self:self,overlay:overlay});_lastset=_lastset.add(overlay)});$(window).resize(function(){$.each(_targets,function(i,e){if(!e){return}e.overlay.css("width",e.self.outerWidth()).css("height",e.self.outerHeight());if(e.self.css("position")==='fixed'){var box=e.self.get(0).getBoundingClientRect();e.overlay.css("top",box.top).css("left",box.left)}else{var tmp=e.self.offset();e.overlay.css("top",tmp.top).css("left",tmp.left)}})});$(window).resize();return this}}(jQuery))
